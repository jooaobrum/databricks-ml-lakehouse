resources:
  jobs:
    olist_ingestion_pipeline:
      name: olist_ingestion_pipeline
      max_concurrent_runs: 3
      job_clusters:
        - job_cluster_key: "ingestion-cluster"
          new_cluster:
            spark_version: "15.4.x-scala2.12"
            data_security_mode: "SINGLE_USER"
            node_type_id: "Standard_DS3_v2"
            driver_node_type_id: "Standard_DS3_v2"
            autoscale:
              min_workers: 1
              max_workers: 1
      tags:
        env: ${bundle.target}
        task: "ingestion"
      tasks:
        # BRONZE TASKS
        - task_key: bronze__olist__olist_customers
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl


        - task_key: bronze__olist__olist_geolocation
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_order_items
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_order_payments
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_order_reviews
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_orders
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_products
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: bronze__olist__olist_sellers
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/bronze/olist/bronze_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--file_format"
              - "csv"
              - "--delimiter"
              - ","
              - "--header"
              - "true"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        # SILVER TASKS WITH DEPENDENCIES
        - task_key: silver__olist__olist_customers
          depends_on:
            - task_key: bronze__olist__olist_customers
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_geolocation
          depends_on:
            - task_key: bronze__olist__olist_geolocation
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_order_items
          depends_on:
            - task_key: bronze__olist__olist_order_items
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_order_payments
          depends_on:
            - task_key: bronze__olist__olist_order_payments
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_order_reviews
          depends_on:
            - task_key: bronze__olist__olist_order_reviews
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_orders
          depends_on:
            - task_key: bronze__olist__olist_orders
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_products
          depends_on:
            - task_key: bronze__olist__olist_products
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl

        - task_key: silver__olist__olist_sellers
          depends_on:
            - task_key: bronze__olist__olist_sellers
          job_cluster_key: ingestion-cluster
          spark_python_task:
            python_file: "../../scripts/ingestions/silver/olist/silver_ingestion.py"
            parameters:
              - "--root_path"
              - "${workspace.root_path}"
              - "--env"
              - "${bundle.target}"
              - "--partitions"
              - "dt_ingestion"
              - "--task_key"
              - "{{task.name}}"
          libraries:
            - whl: ../../dist/*.whl
